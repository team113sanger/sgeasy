% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data-wrangling.R
\name{correct_position_effect}
\alias{correct_position_effect}
\title{Correct for positional effects using neutral variants}
\usage{
correct_position_effect(
  pos_ratio,
  neutral_variants = c("synonymous_variant"),
  span = 0.3,
  min_neutral = 20
)
}
\arguments{
\item{pos_ratio}{A data frame from \code{\link[=calculate_position_effect]{calculate_position_effect()}} containing
at minimum: \code{ratio}, \code{vcf_pos}, \code{Consequence}, and
\code{targeton_id} columns.}

\item{neutral_variants}{Character vector of VEP consequence types to use
as the neutral reference (default: \code{"synonymous_variant"}).}

\item{span}{Loess span parameter controlling smoothness of the fit.
Lower values produce more local fits that capture cut-site effects;
higher values produce smoother global trends (default: 0.3).}

\item{min_neutral}{Minimum number of neutral variants with valid ratios
required to fit the model. Targetons with fewer neutral variants will
not be corrected and a warning is issued (default: 20).}
}
\value{
The input data frame with additional columns:
\describe{
\item{pos_effect}{The fitted positional bias (log2 scale) at each
variant's position}
\item{corrected_log2_ratio}{log2(ratio) minus the positional effect}
}
}
\description{
Fits a loess regression on neutral (e.g. synonymous) variants' log2 ratios
as a function of genomic position, then subtracts the fitted positional
bias from all variants. This is performed independently per targeton.
}
\details{
This is analogous to the median-based LFC adjustment performed by
\code{\link[=calculate_median_scores]{calculate_median_scores()}}, but operates in the spatial dimension
rather than as a single global correction.
}
\examples{
\dontrun{
pos_data <- calculate_position_effect(count_data, annotation, "Day4")
corrected <- correct_position_effect(pos_data)

# With custom parameters
corrected <- correct_position_effect(
  pos_data,
  neutral_variants = c("synonymous_variant", "intron_variant"),
  span = 0.15
)
}

}
\seealso{
\code{\link[=calculate_position_effect]{calculate_position_effect()}}, \code{\link[=calculate_median_scores]{calculate_median_scores()}}
}
